000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. PJG4FTST.
000300
000400 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SPECIAL-NAMES.
000700      DECIMAL-POINT IS COMMA.
000800
000900 DATA DIVISION.
001000 WORKING-STORAGE SECTION.
001100
001200*** VARIABLES POUR LES TESTS DE VENTES TAX (TVA) ***
001300
001400 01 WS-SUB-TOTAL          PIC 9(5)V99.
001500 01 WS-TAX-RATE           PIC 99V99.
001600 01 WS-SALES-TAX          PIC 9(5)V99.
001700 01 WS-EXPECTED-TAX       PIC 9(5)V99.
001800
001900*** VARIABLES D'AFFICHAGE ET DE FORMATAGE ***
002000*   LIB : LIBELLE DU TEST EN COURS
002100*   L-SEP : LIGNE DE SEPARATION VISUELLE
002200
002300 01 LIB                   PIC X(40).
002400 01 L-SEP                 PIC X(60) VALUE ALL "*".
002500
002600
002700 LINKAGE SECTION.
002800 COPY TESTCONT.
002900
003000
003100 PROCEDURE DIVISION USING TEST-CONTEXT.
003200
003300     DISPLAY L-SEP
003400     DISPLAY "*** TESTS UNITAIRES - PJG4FACT ***"
003500     DISPLAY "*** FONCTIONNALITE : CALCULS FINANCIERS ***"
003600     DISPLAY L-SEP
003700     DISPLAY " "
003800
003900*=====================================================
004000* EXECUTION DE TOUS LES TESTS DE SALES TAX (TVA)
004100*=====================================================
004200
004300     DISPLAY "=== BLOC 1 : TESTS CALCUL SALES TAX (TVA) ==="
004400     DISPLAY " "
004500
004600     PERFORM TEST-TAX-20-PERCENT
004700     DISPLAY "RéSULTATS : RUN>", TESTS-RUN,
004800             " OK>", PASSES, " KO>", FAILURES
004900     DISPLAY " "
005000
005100
005200     GOBACK.
005300
005400***********************************************************
005500* TESTS DE CALCUL SALES TAX (TVA)                         *
005600*                                                         *
005700* FORMULE TESTEE (ISSUE DE PJG4FACT LIGNE 741) :          *
005800* COMPUTE WS-SALES-TAX = WS-TAX-RATE / 100 * WS-SUB-TOTAL *
005900*                                                         *
006000* EXEMPLE : SUB-TOTAL = 100$, TAUX = 20%                  *
006100*           SALES TAX = (20 / 100) × 100 = 20X            *
006200***********************************************************
006300
006400
006500 TEST-TAX-20-PERCENT.
006600
006700     DISPLAY 'TEST 1.1 : TVA 20% SUR 100,00'
006800
006900* PREPARER LES DONNEES D'ENTREE
007000
007100     MOVE 100,00 TO WS-SUB-TOTAL
007200     MOVE 20,00  TO WS-TAX-RATE
007300     MOVE 20,00  TO WS-EXPECTED-TAX
007400     MOVE "TEST-TAX-20-PERCENT" TO LIB
007500
007600* ACT & ASSERT : CALCULER ET VERIFIER
007700
007800     PERFORM CALC-TAX-AND-ASSERT
007900     .
008000
008100
008200 CALC-TAX-AND-ASSERT.
008300
008400* ACT : REPLIQUE EXACTE DE LA FORMULE DE PJG4FACT (LIGNE 741)
008500
008600     COMPUTE WS-SALES-TAX = WS-TAX-RATE / 100 * WS-SUB-TOTAL
008700     DISPLAY 'WS-SALES-TAX TROUVE : ' WS-SALES-TAX
008800* ASSERT : APPEL DU FRAMEWORK DE TEST POUR COMPARER
008900* ASSEQ = "ASSERT EQUAL" -> VERIFIE QUE LES 2 VALEURS SONT EGALES
009000
009100     CALL "ASSEQ" USING TEST-CONTEXT, LIB,
009200                        WS-EXPECTED-TAX, WS-SALES-TAX
009300     .
